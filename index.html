<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday</title>
<style>
  body { margin: 0; padding: 0; font-family: 'Arial', sans-serif; background: #fff0f7; overflow-x: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }

  /* Intro page with animated cake */
  #introPage { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
  #introPage img { width: 250px; height: auto; }
  #introPage h1 { font-size: 28px; color: #e7008a; margin-top: 20px; opacity: 0; transition: opacity 2s ease; }

  /* Happy Birthday page */
  #mainPage { display: none; width: 100vw; height: 100vh; padding: 20px; box-sizing: border-box; }
  .container { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; }
  .photo-box { width: 90%; height: 55vh; border-radius: 18px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.15); margin-bottom: 20px; }
  .photo-box img { width: 100%; height: 100%; object-fit: cover; }
  .name { font-size: 32px; font-weight: bold; color: #e7008a; margin-top: 18px; text-align: center; }
  .msg { margin-top: 8px; font-size: 18px; color: #444; text-align: center; line-height: 1.5; padding: 0 10px; }
</style>
</head>
<body>
  <!-- Intro page with animated GIF cake -->
  <div id="introPage">
    <img src="photos/cake_animated.gif" alt="Cake Animation">
    <h1 id="introText">Blow the candles to start ðŸŽ‚</h1>
  </div>

  <!-- Main birthday page -->
  <div id="mainPage">
    <div class="container">
      <div class="photo-box"><img id="photo" src="" /></div>
      <div class="name" id="herName"></div>
      <div class="msg" id="herMsg"></div>
    </div>
  </div>

  <audio id="bgAudio" autoplay loop>
    <source src="audio/happy_song.mp3" type="audio/mpeg">
  </audio>

<script>
// Intro animation and audio
const introText = document.getElementById('introText');
const introPage = document.getElementById('introPage');
const mainPage = document.getElementById('mainPage');
const audio = document.getElementById('bgAudio');

// Load her info and photos
fetch('data/data.json')
  .then(res => res.json())
  .then(data => {
    document.getElementById('herName').innerText = data.name;
    document.getElementById('herMsg').innerText = data.message;

    const photos = data.photos;
    let index = 0;
    const photoEl = document.getElementById('photo');

    function showNextPhoto() {
      photoEl.src = 'photos/' + photos[index];
      index = (index + 1) % photos.length;
    }
    showNextPhoto();
    setInterval(showNextPhoto, 3500);
  });

// Blow detection for intro page
async function detectBlow() {
  const mic = await navigator.mediaDevices.getUserMedia({ audio: true });
  const ctx = new (window.AudioContext)();
  const analyser = ctx.createAnalyser();
  const micSource = ctx.createMediaStreamSource(mic);
  micSource.connect(analyser);

  const dataArr = new Uint8Array(analyser.frequencyBinCount);

  function checkNoise() {
    analyser.getByteFrequencyData(dataArr);
    let volume = dataArr.reduce((a,b)=>a+b)/dataArr.length;
    if(volume > 35) { // blowing threshold
      startBirthdayPage();
      return;
    }
    requestAnimationFrame(checkNoise);
  }
  checkNoise();
}

function startBirthdayPage() {
  introText.style.opacity = 0;
  setTimeout(() => {
    introPage.style.display = 'none';
    mainPage.style.display = 'flex';
  }, 2000);
}

detectBlow();
</script>
</body>
</html>
